/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var C=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var D=(p,a)=>{for(var e in a)C(p,e,{get:a[e],enumerable:!0})},F=(p,a,e,t)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of M(a))!x.call(p,n)&&n!==e&&C(p,n,{get:()=>a[n],enumerable:!(t=B(a,n))||t.enumerable});return p};var V=p=>F(C({},"__esModule",{value:!0}),p);var z={};D(z,{default:()=>N});module.exports=V(z);var c=require("obsidian");function k(p,a){let e=Object.keys(a).map(t=>R(p,t,a[t]));return e.length===1?e[0]:function(){e.forEach(t=>t())}}function R(p,a,e){let t=p[a],n=p.hasOwnProperty(a),s=n?t:function(){return Object.getPrototypeOf(p)[a].apply(this,arguments)},o=e(s);return t&&Object.setPrototypeOf(o,t),Object.setPrototypeOf(r,o),p[a]=r,i;function r(...u){return o===s&&p[a]===r&&i(),o.apply(this,u)}function i(){p[a]===r&&(n?p[a]=s:delete p[a]),o!==s&&(o=s,Object.setPrototypeOf(r,t||Function))}}var T=require("obsidian"),U={"after-active":"After active tab","after-pinned":"After pinned tabs",beginning:"At beginning",end:"At end"},v={same:"In same tab group",opposite:"In opposite tab group",first:"In first tab group",last:"In last tab group"},P={tab:"In new tab",same:"In same tab",allow_duplicate:"In duplicate tab",opposite:"In opposite tab group"},L={openInNewTab:!0,deduplicateTabs:!0,deduplicateAcrossTabGroups:!0,newTabPlacement:"after-active",newTabTabGroupPlacement:"same",modClickBehavior:"tab"},O=class extends T.PluginSettingTab{constructor(a,e){super(a,e),this.plugin=e}display(){this.containerEl.empty(),new T.Setting(this.containerEl).setName("Always open in new tab").setDesc("Open files in a new tab by default.").addToggle(a=>a.setValue(this.plugin.settings.openInNewTab).onChange(async e=>{let t=this.plugin.settings.modClickBehavior;await this.plugin.updateSettings({openInNewTab:e,modClickBehavior:!e&&t=="same"?"tab":t}),this.display()})),new T.Setting(this.containerEl).setName("Prevent duplicate tabs").setDesc("If a tab is already open, switch to it instead of re-opening it.").addToggle(a=>a.setValue(this.plugin.settings.deduplicateTabs).onChange(async e=>{let t=this.plugin.settings.modClickBehavior;await this.plugin.updateSettings({deduplicateTabs:e,modClickBehavior:!e&&t=="allow_duplicate"?"tab":t}),this.display()})),new T.Setting(this.containerEl).setName("Deduplicate across tab groups").setDesc("Whether to switch to already open file even if its in a split pane or popout window").addToggle(a=>a.setValue(this.plugin.settings.deduplicateAcrossTabGroups).onChange(async e=>{await this.plugin.updateSettings({deduplicateAcrossTabGroups:e})})).setDisabled(!this.plugin.settings.deduplicateTabs).settingEl.setCssStyles({opacity:this.plugin.settings.deduplicateTabs?"":"50%"}),new T.Setting(this.containerEl).setName("Focus explicit new tabs").setDesc("Immediately switch to new tabs opened via middle or ctrl click instead of opening them in the background. New tabs created by regular click will always focus regardless.").addToggle(a=>a.setValue(this.app.vault.getConfig("focusNewTab")).onChange(async e=>{this.app.vault.setConfig("focusNewTab",e)})),new T.Setting(this.containerEl).setName("New tab placement").setDesc("Place new tabs...").addDropdown(a=>a.addOptions(U).setValue(this.plugin.settings.newTabPlacement).onChange(async e=>{await this.plugin.updateSettings({newTabPlacement:e})})),new T.Setting(this.containerEl).setName("New tab tab group placement").setDesc("When the workspace is split, prefer to open new tabs...").addDropdown(a=>a.addOptions(v).setValue(this.plugin.settings.newTabTabGroupPlacement).onChange(async e=>{await this.plugin.updateSettings({newTabTabGroupPlacement:e})})),new T.Setting(this.containerEl).setName("Mod click behavior").setDesc("On Ctrl/Cmd/middle click open links...").addDropdown(a=>{a.addOption("tab",P.tab),this.plugin.settings.openInNewTab&&a.addOption("same",P.same),this.plugin.settings.deduplicateTabs&&a.addOption("allow_duplicate",P.allow_duplicate),a.addOption("opposite",P.opposite),a.setValue(this.plugin.settings.modClickBehavior).onChange(async e=>{console.log("modClickBehavior onChange"),await this.plugin.updateSettings({modClickBehavior:e})})})}};var j={md:["excalidraw","kanban"]};function m(p){return["empty","home-tab-view"].includes(p.view.getViewType())}function W(p){let a=p.getRoot();return a instanceof c.WorkspaceRoot||a instanceof c.WorkspaceFloating}function A(p){return p[0].toUpperCase()+p.slice(1)}function E(p,a){return`${p||""}:${JSON.stringify(a)}`}function K(p){if(p){if(p===!0)return["tab",{}];{let[a,...e]=p.split(":"),t=e.join(":")||"{}";return[a||!1,JSON.parse(t)]}}else return[!1,{}]}var S={tab:"tab",same:E(!1,{openInNewTab:!1}),allow_duplicate:E(!1,{deduplicateTabs:!1}),opposite:E("tab",{newTabTabGroupPlacement:"opposite"})},N=class extends c.Plugin{constructor(){super(...arguments);this.settings={...L}}async onload(){await this.loadSettings(),this.addSettingTab(new O(this.app,this)),this.registerMonkeyPatches(),this.registerEvent(this.app.workspace.on("file-menu",(t,n,s,o)=>{if(n instanceof c.TFile){this.settings.openInNewTab&&t.addItem(i=>{i.setSection("open"),i.setIcon("file-minus"),i.setTitle("Open in same tab"),i.onClick(async()=>{await this.app.workspace.getLeaf(S.same).openFile(n)})}),this.settings.deduplicateTabs&&this.findMatchingLeaves(n).length>0&&t.addItem(i=>{i.setSection("open"),i.setIcon("files"),i.setTitle("Open in duplicate tab"),i.onClick(async()=>{await this.app.workspace.getLeaf(S.allow_duplicate).openFile(n)})});let r=this.app.workspace.getMostRecentLeaf();r&&this.getAllTabGroups(r.getRoot()).length>1&&t.addItem(i=>{i.setSection("open"),i.setIcon("lucide-split-square-horizontal"),i.setTitle("Open in opposite tab group"),i.onClick(async()=>{await this.app.workspace.getLeaf(S.opposite).openFile(n)})})}}));let e=[["openInNewTab","always open in new tab"],["deduplicateTabs","prevent duplicate tabs"]];for(let[t,n]of e){let s=t.replace(/[A-Z]/g,o=>`-${o.toLowerCase()}`);this.addCommand({id:`toggle-${s}`,name:`Toggle ${n}`,callback:async()=>{await this.updateSettings({[t]:!this.settings[t]}),new c.Notice(`${A(n)} ${this.settings[t]?"ON":"OFF"}`,2500)}}),this.addCommand({id:`enable-${s}`,name:`Enable ${n}`,callback:async()=>{await this.updateSettings({[t]:!0}),new c.Notice(`${A(n)} ${this.settings[t]?"ON":"OFF"}`,2500)}}),this.addCommand({id:`disable-${s}`,name:`Disable ${n}`,callback:async()=>{await this.updateSettings({[t]:!1}),new c.Notice(`${A(n)} ${this.settings[t]?"ON":"OFF"}`,2500)}})}this.addCommand({id:"cycle-tab-group-placement",name:"Cycle tab group placement",callback:async()=>{let t=Object.keys(v),n=t.findIndex(o=>o==this.settings.newTabTabGroupPlacement),s=t[(n+1)%t.length];await this.updateSettings({newTabTabGroupPlacement:s}),new c.Notice(`Tab group placement: ${v[s]}`,2500)}})}registerMonkeyPatches(){let e=this;this.register(k(c.Workspace.prototype,{getLeaf(t){return function(n,...s){var g;let[o,r]=K(n),i={...e.settings,...r},u=(g=this.getActiveViewOfType(c.View))==null?void 0:g.leaf,l;return o=="tab"||!o&&i.openInNewTab?l=e.createNewLeaf(o?void 0:!0,i):o?l=t.call(this,o,...s):l=e.getUnpinnedLeaf(!0,i),l.openTabSettings={openMode:o,override:r,openedFrom:u==null?void 0:u.id},l}},getUnpinnedLeaf(t){return function(n){return e.settings.openInNewTab?this.getLeaf("tab"):e.getUnpinnedLeaf(n)}}})),this.register(k(c.WorkspaceLeaf.prototype,{openFile(t){return async function(n,s,...o){var I,_,G;let r,i;m(this)||delete this.openTabSettings;let{openMode:u,override:l,openedFrom:g}=(I=this.openTabSettings)!=null?I:{},d={...e.settings,...l},f=e.findMatchingLeaves(n);d.deduplicateAcrossTabGroups||(f=f.filter(b=>b.parent==this.parent));let h=!W(this)||m(this)&&![!1,"tab"].includes(u!=null?u:"unknown"),w=m(this)&&u===!1&&!!((_=s==null?void 0:s.eState)!=null&&_.subpath)&&f.some(b=>b.id==g),y=f.includes(this);if(w&&!h&&!y?i=f.find(b=>b.id==g):d.deduplicateTabs&&!h&&f.length>0&&!y&&(i=f.find(b=>b.id==g),i||f.find(b=>b.parent==this.parent),i||(i=f[0])),i)if(i.view.getViewType()=="kanban")e.app.workspace.setActiveLeaf(f[0]),r=void 0;else{let b=(G=e.app.workspace.getActiveViewOfType(c.View))==null?void 0:G.leaf;r=await t.call(f[0],n,{...s,active:!!(s!=null&&s.active)||b==this},...o)}else r=await t.call(this,n,s,...o);return m(this)&&this.parent.children.length>1&&this.detach(),delete this.openTabSettings,r}}})),this.register(k(c.Keymap,{isModEvent(t){return function(...n){let s=t.call(this,...n);return s=="tab"&&(s=S[e.settings.modClickBehavior]),s}}}))}async loadSettings(){var t;let e=(t=await this.loadData())!=null?t:{};this.settings=Object.assign({},L,e),Object.keys(e).length==0&&(this.app.vault.setConfig("focusNewTab",!1),await this.updateSettings({}))}async updateSettings(e){Object.assign(this.settings,e),await this.saveData(this.settings)}findMatchingLeaves(e){let t=[];return this.app.workspace.iterateAllLeaves(n=>{var i,u,l;let s=((u=(i=n.getViewState())==null?void 0:i.state)==null?void 0:u.file)==e.path,o=n.view.getViewType(),r=this.app.viewRegistry.getTypeByExtension(e.extension)==o||((l=j[e.extension])==null?void 0:l.includes(o));W(n)&&s&&r&&t.push(n)}),t}getAllTabGroups(e){let t=new Set;return this.app.workspace.iterateAllLeaves(n=>{n.getRoot()==e&&t.add(n.parent)}),[...t]}createNewLeaf(e,t={}){let n=this,s=n.app.workspace;e=e!=null?e:n.app.vault.getConfig("focusNewTab");let o={...n.settings,...t},r=s.getMostRecentLeaf();if(!r)throw new Error("No tab group found.");let i=r.parent,u=i.children.indexOf(r);if(m(r))return r;let l,g;if(o.newTabTabGroupPlacement!="same"&&!c.Platform.isPhone){let h=n.getAllTabGroups(r.getRoot()),w=h.filter(y=>y!==i).at(-1);o.newTabTabGroupPlacement=="opposite"&&w?l=w:o.newTabTabGroupPlacement=="first"&&h.at(0)?l=h[0]:o.newTabTabGroupPlacement=="last"&&h.at(-1)&&(l=h.at(-1))}if(l||(l=i),l==i)if(o.newTabPlacement=="after-pinned"){let h=l.children.findLastIndex(w=>w.pinned);g=h>=0?h+1:u+1}else o.newTabPlacement=="beginning"?g=0:o.newTabPlacement=="end"?g=i.children.length:g=u+1;else o.newTabPlacement=="beginning"?g=0:g=i.children.length;let d,f=l.children[Math.min(g,l.children.length-1)];if(m(f))d=f;else{d=new c.WorkspaceLeaf(this.app);let h=l.currentTab;l.insertChild(g,d),g<=h&&(l!=i||!e)&&l.selectTabIndex(h+1)}return e&&s.setActiveLeaf(d),d}getUnpinnedLeaf(e=!0,t={}){var l;let n=this,s=n.app.workspace,o={...n.settings,...t},r=s.activeLeaf;if(r!=null&&r.canNavigate())return r;let i=(l=r==null?void 0:r.getContainer())!=null?l:s.rootSplit,u=null;return s.iterateLeaves(i,g=>{if(g.canNavigate()){let d=g.parent;d&&(d.children[d.currentTab]===g||d instanceof c.WorkspaceTabs&&d.isStacked)&&(!u||u.activeTime<g.activeTime)&&(u=g)}}),u?e&&s.setActiveLeaf(u):u=n.createNewLeaf(e,o),u}};

/* nosourcemap */